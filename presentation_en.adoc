= ğŸ•ºimage:images/kapoeira_logo_text.png[width=200]ğŸ’ƒ
:source-highlighter: highlight.js
:highlightjs-languages: bash, gherkin, javascript, json, scala
:icons: font
:burger-quiz-url: https://github.com/jvauchel/kapoeira-dance/blob/main/burger-quiz

image::images/kapoeira.gif[]

== Presentation
image::images/hello.gif[width=500]

=== Presentation
image::images/kara.jpeg[width=300]

Mehdi Rebiai::
* icon:github[] https://mrebiai.github.io/[^]
* icon:envelope[] mehdi.rebiai.dev@gmail.com
* Techlead & Data engineer at https://www.lectra.com[Lectra^]

=== Presentation

image::images/odile.jpeg[width=400]

Johanna Vauchel::
* icon:github[] https://jvauchel.github.io/[^]
* icon:envelope[] vauchel.johanna@gmail.com
* Data engineer at https://www.lectra.com[Lectra^] & speaker ğŸ¤

ifdef::conf-webinar[]
=== Presentation
image::images/darmon.jpg[width=400]

FranÃ§ois Barbe::
* icon:github[] https://github.com/fb33[^]
* icon:envelope[] f.barbe@lectra.com
* Principal Architect at https://www.lectra.com[Lectra^]
endif::[]

== Opensource at Lectra
image::images/opensource.gif[width=500]


ifdef::conf-bdxio[]
=== Lectra
* Member of https://naos-cluster.com/
* Partner in the https://hermine-foss.org/ project
* Github : https://github.com/lectra-tech/
* Dockerhub : https://hub.docker.com/u/lectratech
endif::[]


ifdef::conf-webinar[]
=== Lectra
image::images/lectra-4.0.png[width=800]

=== Lectra
image:images/lectra-numbers.png[width=800]

=== Opensource

[%step]
* Use Foss projects to build our solutions
** define a Foss policy to manage this usage
* Use Innersource projects
** incubator for future Opensource projects
* Contributor and creator of Opensource projects
** Partner in the https://hermine-foss.org/ project
** Kapoeira ...
endif::[]

== Take Away ğŸ
image::images/take-away.gif[width=500]

=== Take Away ğŸ

[%step]
* Discover a new tool to *test* your kafka streams
* Help you in your *communication* with PO/QA/DEV
* *Tips* to use it every day
* Have a good time (we hope)

== ğŸ“½ï¸ Kapoeira story ğŸ¬
image::images/cine.gif[width=800]

[.columns]
=== Connected Cutters

[.column]
image:images/vector.png[width=400]::
* Thousands of cutters
* Millions events every day

[.column width="30%"]
image::images/combien.gif[width=300]

=== Apache Kafka
image::images/kafka.png[width=600]

=== Our data pipeline

image::images/data-pipeline.png[width=800]

=== We are perfect !

image::images/perfect.jpg[width=800]

=== Data is perfect !

image::images/pipeline-example.png[width=800]

=== No bug in code !
image::images/ca-tombe-bien.gif[width=600]

=== NO !
image::images/no-not.gif[width=600]

=== NO !
image::images/pipeline-example-poo.png[width=800]

=== Data is ğŸ’©
image::images/boucherie.gif[width=600]

=== Solution ?
TESTS OUR STREAMS!

=== How to test ?

https://docs.confluent.io/platform/current/streams/developer-guide/test-streams.html[TopologyTestDriver^]

image::images/fast.jpg[width=500]

Fast and efficient...

=== Scala Test Example

[source, scala]
----
include::code/topology-driver.scala[]
----

=== Happy ğŸ˜€...ğŸ¤®
image::images/content-vomi.gif[width=400]


=== ... But mocked infra â‰  integration with Kafka

image::images/fail.jpeg[width=600]

=== ... And only unit tests => How to test *several* streams ?

image::images/end-to-end.png[width=600]


=== ... OK for Scala DEV but not for QA (=ğŸ‘®)

image::images/les-nuls-police.gif[width=400]

=== ... *Communication* between DEV/PO/QA ?

image::images/simon-kara.gif[width=600]

Acceptance tests !

== What do we need ?

image:images/test-pyramid.png[width=350] image:images/cesar-triangle.gif[width=350]

*Integration* tests with a *simple* syntax

[.columns]
=== Inspiration : Karate

[.column]
image::images/karate.png[width=200]

[.column]
* HTTP-based APIs
* Peter Thomas - 2017
* Simple syntax (https://cucumber.io/docs/gherkin/reference/[Gherkin^])
* https://youtu.be/Cnma3WbKvtE?si=TXYHGSpiib9SATIJ[Talk about Karate @BdxIO2018^]

=== Our context â‰  HTTP
image::images/kafkalogo.jpg[width=500]

Integration with *Kafka Streams* !

== What is Kapoeira?
.A Kapoeira Test
[source, gherkin]
----
include::features/example.feature[]
----

=== What is Kapoeira?
image::images/kapoeira-diagram.png[width=600]

// TODO gif flux data
// step 0 sans kapo et flux donnÃ©es
// step 1 (background) kapo + create consumer & producer
// step 2 produce data 
// step 3 stream tranforme data en data2
// step 4 kapo + consume data2
// step 5 kapo assert

=== What is Kapoeira?
image::diagrams/archi-kapoeira.png[width=500]

// TODO image drawio (Ã  partir de kapoeira-diagram)

=== 2020 - Birth of Kapoeira
image::images/young-chabat.jpg[width=300]

* Inner Source @Lectra
* First syntax created with a QA
* Cucumber calls Confluent CLI

=== CLI...
[source]
----
# Console producer
kafka-console-producer \
  --topic orders \
  --bootstrap-server broker:9092 \

# Console consumer
kafka-console-consumer \
  --topic orders \
  --bootstrap-server broker:9092 \
  --from-beginning
----

=== 2020 - Scala image:images/scala.svg[width=50]
* Specific Scala implementation for Kafka Consumer/Producer
* Better syntax with Gherkin Datatable

image::images/datatable.png[width=400]

=== 2021 - ZIO - https://zio.dev/

image::images/zio.jpeg[width=300]

* To improve perfs
* Add parallel mode
* Batch to manage jointure in topics

=== 2023 - Open Source

image::images/kapoeira_logo_text.png[width=200]

icon:github[] https://github.com/lectra-tech/kapoeira

=== 2024 - New features

image::images/simon.jpeg[width=200]

Thanks to you !

== Demo
image::images/burger-quiz.gif[width=500]

=== User Story nÂ°1

* As a ğŸ§‘â€ğŸ³
* GIVEN my fries-factory 
* WHEN I send a ğŸ¥” to it
* THEN I expect to have ğŸŸ

=== fries-factory image:images/patate.gif[width=300,float=right]
image::diagrams/fries-factory.svg[width=800]

=== User Story nÂ°1 - Solution
* {burger-quiz-url}/fries-factory/it/features/fries-us1.0.feature[1st version^]
* {burger-quiz-url}/fries-factory/it/features/fries-us1.1-uuid.feature[With uuid^]
* {burger-quiz-url}/fries-factory/it/features/fries-us1.2-outline.feature[With Scenario Outline^]

[.columns]
=== User Story nÂ°1 - Report
[.column]
image::images/report-us1.2.png[width=450]

[.column]
image:images/rapport.gif[width=400] 

=== User Story nÂ°2

* As a ğŸ§‘â€ğŸ³
* GIVEN my fries-factory
* WHEN I send ğŸ¥”ğŸ¥”ğŸ¥”ğŸ¥” to it
* THEN I expect to have ğŸŸğŸŸğŸŸğŸŸ

=== User Story nÂ°2 - Solution
* {burger-quiz-url}/fries-factory/it/features/fries-us2.0-files.feature[A feature...^]
* {burger-quiz-url}/fries-factory/it/features/records/potatoes.dat[... calling this file^]
* {burger-quiz-url}/fries-factory/it/features/fries-us2.1-files-tips.feature[A feature with a tip^]

=== User Story nÂ°2 - Report
image::images/report-us2.0.png[width=450]

=== User Story nÂ°3

* As a ğŸ§‘â€ğŸ³
* GIVEN my fries-factory
* WHEN I send ğŸ¥” to it, with [.red]#KETCHUP(ğŸ…)# as Kafka Header
* THEN I expect to have a ğŸŸ with [.red]#KETCHUP(ğŸ…)# as Kafka Header

=== User Story nÂ°3 - Solution
* {burger-quiz-url}/fries-factory/it/features/fries-us3.feature[A feature...^]
* {burger-quiz-url}/fries-factory/it/features/records/potatoesWithHeaders.dat[... calling this file^]

=== User Story nÂ°3 - Report
image::images/report-us3.png[width=450]

=== User Story nÂ°4

* As a ğŸ§‘â€ğŸ³
* GIVEN my burger-factory
* WHEN I send the ingredients (ğŸ,ğŸ…,ğŸ¥©) to it
* THEN I expect to have a delicious ğŸ”

=== burger-factory image:images/sel-poivre.gif[width=200,float=right]
image::diagrams/burger-factory.svg[width=800]

=== User Story nÂ°4 - Solution
{burger-quiz-url}/burger-factory/it/features/burger-us4.feature[Here^]

=== User Story nÂ°4 - Report
image::images/report-us4.png[width=375]

=== User Story nÂ°5

* As a ğŸ§‘â€ğŸ³
* GIVEN my meal-factory
* WHEN I send a ğŸ” and some side dishes ğŸŸ to it
* THEN I expect to have a great meal (ğŸ” + ğŸŸ)

=== meal-factory image:images/chewing-gum.gif[width=300,float=right]
image::diagrams/meal-factory.svg[width=800]

=== User Story nÂ°5 - Solution
{burger-quiz-url}/meal-factory/it/features/meal-us5.feature[Here^]

=== User Story nÂ°5 - Report
image::images/report-us5.png[width=400]

=== User Story nÂ°6

* As a ğŸ§‘â€ğŸ³
* GIVEN my burger-quiz
* WHEN I send the ingredients (ğŸ,ğŸ…,ğŸ¥©) and a ğŸ¥” to it
* THEN I expect to have a great meal (ğŸ” + ğŸŸ)

=== User Story nÂ°6 image:images/burger-quiz.gif[width=200,float=right]
image::diagrams/burger-quiz.svg[width=800]

=== User Story nÂ°6 - Solution
{burger-quiz-url}/end-to-end/it/features/end-to-end-us6.feature[Here^]

=== User Story nÂ°6 - Report
image::images/report-us6.png[width=325]

== ğŸ¥¦ REX ğŸ¥ƒ

image::images/whisky.gif[width=500]

=== (Grand) REX  image:images/red-is-dead.jpg[width=100]

[%step]
* ğŸ‘ Big community in Lectra
* ğŸ¤ Used as acceptance tests, specifications during story grooming
* âœï¸ Easy for QA to enrich existing tests
* ğŸ”„ Used as end-to-end tests

[.columns]
=== Advantages ğŸ’ª

[.column]
image::images/bluff.gif[width=500]

[.column]
[%step]
* Kafka infra
* Simple to use
* Communicate with PO/QA/DEV
* Tests as documentation
* Tests as acceptance for stories

== Want to use it ? ğŸ‘©â€ğŸ­

image::images/banco.gif[width=500]


=== How to use ? âš’ï¸

https://hub.docker.com/r/lectratech/kapoeira[^]

[source, bash]
----
docker run --rm -ti 
-v <PATH_TO_YOUR_FEATURES_FOLDER>:/features \
-e KAFKA_BOOTSTRAP_SERVER=<HOST:PORT[,HOST2:PORT2,HOST3:PORT3,...]> \
-e KAFKA_USER=<XXX> \
-e KAFKA_PASSWORD=<****> \
lectratech/kapoeira
----

=== More options

[source, bash]
----
docker run --rm -ti \
-v <PATH_TO_YOUR_FEATURES_FOLDER>:/features \
-v <PATH_TO_YOUR_REPORTS>:/reports \
-v /var/run/docker.sock:/var/run/docker.sock \
-e KAFKA_BOOTSTRAP_SERVER=<HOST:PORT[,HOST2:PORT2,HOST3:PORT3,...]> \
-e KAFKA_SCHEMA_REGISTRY_URL=<URL> \
-e JAAS_AUTHENT=<true(default) | false> \
-e KAFKA_USER=<XXX> \
-e KAFKA_PASSWORD=<****> \
-e LOGGING_LEVEL=<INFO (default) | ERROR | ...> \
-e THREADS=<8 (default) | ... > \
lectratech/kapoeira
----

=== How to contribute ? https://github.com/lectra-tech/kapoeira/blob/main/CONTRIBUTING.adoc[See here^] 
image::images/contribute.gif[width=500]

== Thank you !

image::images/cauchemar.gif[width=500]

[.columns]
=== Thanks for your feedback

[.column width="70%"]
icon:github[] https://github.com/lectra-tech/kapoeira[^] +
 +
icon:github[] https://jvauchel.github.io/[^] +
icon:github[] https://mrebiai.github.io/[^] +
ifdef::conf-webinar[]
icon:github[] https://github.com/fb33/[^] +
endif::[]
 +
icon:envelope[] vauchel.johanna@gmail.com +
icon:envelope[] mehdi.rebiai.dev@gmail.com +
ifdef::conf-webinar[]
icon:envelope[] f.barbe@lectra.com +
endif::[]

[.column width="30%"]
ifdef::conf-webinar[]
image::images/WebinarQRCode.png[width=200]
endif::[]
ifdef::conf-bdxio[]
TODO QR Code OpenFeedback
endif::[]